{"version":3,"sources":["fader.es6"],"names":["constraintNumber","n","min","max","Math","mapNumber","start1","stop1","start2","stop2","Fader","transitionTime","parseInt","getAttribute","amp","value","startValue","startX","onTouchStart","bind","onTouchEnd","onTouchMove","onMouseDown","onMouseMove","onMouseUp","addEventListener","updateSlides","e","startDragging","targetTouches","pageX","preventDefault","drag","stopDragging","window","removeEventListener","x","cancelAnimation","classList","add","offsetWidth","delta","remove","snapToNearestSlide","slides","children","slideSize","length","i","start","stop","style","opacity","animationStart","Date","animationStop","getTime","animationStartX","animationStopX","getNearestSlideValue","animate","time","now","easing","requestAnimationFrame","t","_value","dispatchEvent","Event","bubbles","HTMLElement","document","registerElement"],"mappings":"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","file":"fader.js","sourcesContent":["const constraintNumber = (n, min = 0, max = 1) =>\n  Math.min(Math.max(n, min), max)\n/** @see https://github.com/processing/p5.js/blob/master/src/math/calculation.js */\nconst mapNumber = (n, start1, stop1, start2 = 0, stop2 = 1) =>\n  ((n - start1) / (stop1 - start1)) * (stop2 - start2) + start2\n\n\n// Implementation\n\nclass Fader extends HTMLElement {\n  // “constructor”\n  createdCallback() {\n    // initial properties\n    this.transitionTime = parseInt(this.getAttribute('transitionTime')) || 300\n    this.amp = 0\n    this.value = 0\n    this.startValue = 0\n    this.startX = 0\n\n    // import handlers from prototype to obj\n    this.onTouchStart = this.onTouchStart.bind(this)\n    this.onTouchEnd = this.onTouchEnd.bind(this)\n    this.onTouchMove = this.onTouchMove.bind(this)\n    this.onMouseDown = this.onMouseDown.bind(this)\n    this.onMouseMove = this.onMouseMove.bind(this)\n    this.onMouseUp = this.onMouseUp.bind(this)\n\n    // add handlers\n    this.addEventListener('touchstart', this.onTouchStart, true)\n    this.addEventListener('touchend', this.onTouchEnd, true)\n    this.addEventListener('touchmove', this.onTouchMove, true)\n    this.addEventListener('mousedown', this.onMouseDown)\n  }\n\n  // added to the DOM\n  attachedCallback() {\n    this.updateSlides()\n  }\n\n\n  // touch handlers\n  onTouchStart(e) {\n    this.startDragging(e.targetTouches[0].pageX)\n  }\n  onTouchMove(e) {\n    e.preventDefault()\n\n    this.drag(e.targetTouches[0].pageX)\n  }\n  onTouchEnd(e) {\n    this.stopDragging()\n  }\n\n\n  // mouse handlers\n  onMouseDown(e) {\n    e.preventDefault()\n    this.startDragging(e.pageX)\n    window.addEventListener('mousemove', this.onMouseMove)\n    window.addEventListener('mouseup', this.onMouseUp)\n  }\n  onMouseMove(e) {\n    this.drag(e.pageX)\n  }\n  onMouseUp(e) {\n    this.stopDragging()\n    window.removeEventListener('mousemove', this.onMouseMove)\n    window.removeEventListener('mouseup', this.onMouseUp)\n  }\n\n\n\n  // calculations\n  startDragging(x) {\n    this.cancelAnimation()\n    this.classList.add('grabbing')\n    this.startValue = this.value // store the current value\n    this.startX = x // store where the interaction started\n    this.amp = this.offsetWidth || 1000\n  }\n  drag(x) {\n    const delta = constraintNumber(\n      mapNumber(x - this.startX, -this.amp, this.amp, -1, 1),\n      - this.startValue, 1 - this.startValue\n    )\n\n    this.value = this.startValue + delta\n\n    this.updateSlides()\n  }\n  stopDragging() {\n    this.classList.remove('grabbing')\n    this.snapToNearestSlide()\n  }\n\n\n  // show the right combination for the current value\n  updateSlides() {\n    const slides = this.children\n    const slideSize = 1 / (slides.length - 1)\n\n    for (let i = 1; i < slides.length; i++) {\n      const start = (i - 1) * slideSize\n      const stop = i * slideSize\n\n      slides[i].style.opacity = constraintNumber(mapNumber(this.value, start, stop))\n    }\n  }\n\n  snapToNearestSlide() {\n    // @TODO duration? static? dynamic? configurable?\n    this.animationStart = new Date()\n    this.animationStop = new Date(this.animationStart.getTime() + this.transitionTime)\n    this.animationStartX = this.value\n    this.animationStopX = this.getNearestSlideValue()\n\n    this.animate()\n  }\n  animate() {\n    if (this.animationStop === null || this.animationStart === null) return\n\n    const amp = this.animationStop - this.animationStart\n    const time = Math.min(mapNumber(amp - (this.animationStop.getTime() - Date.now()), 0, amp), 1)\n    const delta = this.animationStopX - this.animationStartX\n\n    this.value = this.animationStartX + (this.easing(time) * delta)\n    this.updateSlides()\n\n    if (time >= 1) return\n\n    if (window.requestAnimationFrame) window.requestAnimationFrame(this.animate.bind(this))\n    else this.animate()\n  }\n  cancelAnimation() {\n    this.animationStart = null\n    this.animationStop = null\n  }\n\n  getNearestSlideValue() {\n    const slides = this.children\n    const slideSize = 1 / (slides.length - 1)\n\n    for (let i = 0; i < slides.length; i++) {\n      const start = (i * slideSize) - (slideSize / 2)\n      const stop = start + slideSize\n\n      if (this.value > start && this.value <= stop) {\n        return constraintNumber(start + (slideSize / 2))\n      }\n    }\n\n    return 0\n  }\n\n  // easing function\n  easing(t) {\n    // @see https://gist.github.com/gre/1650294\n    return t <.5 ? 2*t*t : -1+(4-2*t)*t;\n  }\n\n  set value(x) {\n    this._value = x\n    this.dispatchEvent(new Event('change', { bubbles: true }))\n  }\n  get value() {\n    return this._value\n  }\n}\n\ndocument.registerElement('felds-fader', Fader)\n"]}